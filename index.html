<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–¢—É—Ä–Ω–∏—Ä–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
<link rel="icon" type="image/png" href="img/edit3.png">
<style>
  :root{
    --bg:#523634; --ink:#2f3e46; --paper:#DDC5A2; --line:#1f2e2d; --frame:#301B28;
    --btn:#52958b; --btn-hover:#004d47; --btn-ready:#c96666; --btn-ready-hover:#991a1a;
    --focus:#00c2a8;
  }
  body { font-family: Arial, sans-serif; background-color: var(--bg); color: var(--ink); padding: 20px; gap: 20px; }
  .flex-horiz { display: flex; justify-content: space-between; gap: 16px; align-items: flex-start; }
  .top-toolbar, .btm-toolbar { display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0; }
  .textAreas { display: grid; grid-template-columns: 1fr; gap: 12px; width: 50%; }
  .textAreas.double { grid-template-columns: 1fr 1fr; }
  .text-wrap { position: relative; }
  .text-wrap.active::after{
    content:"active"; position: absolute; top:6px; right:10px; font-size:12px; color:#000; background:#ffd; padding:2px 6px; border-radius:8px; border:1px solid #00000033;
  }
  textarea {
    width: 100%; height: 300px; border: 2px solid var(--line); border-radius: 5px; padding: 10px;
    background-color: var(--paper); color: var(--line); font-size: 16px; white-space: pre; resize: vertical; outline: none;
  }
  .text-wrap { margin-right: 30px;}
  .text-wrap.active textarea { border-color: var(--focus); box-shadow: 0 0 0 3px #00c2a82a; }
  button { padding: 10px 20px; background-color: var(--btn); color: #000; border: none; border-radius: 5px; cursor: pointer; }
  button:hover { background-color: var(--btn-hover); color: #fff; }
  button.ready { background-color: var(--btn-ready); }
  button.ready:hover { background-color: var(--btn-ready-hover); }
  input.custom-text {
    width: 200px; border: 2px solid var(--line); border-radius: 5px; padding: 5px 10px;
    background-color: var(--paper); color: var(--line); font-size: 16px; margin-top: 10px; margin-bottom: 10px;
  }
  #tableContainer {
    width: 40%; height: fit-content; display: none; overflow-x: auto;
    border: 1px solid var(--frame); background-color: var(--paper); padding: 10px; border-radius: 5px;
  }
  table { border-collapse: collapse; width: 100%; }
  table td { border: 1px solid var(--frame); padding: 10px; text-align: left; }
  .mode { display:flex; gap:12px; align-items:center; margin: 6px 0 12px; }
  .mode label { color:#fff; user-select:none; }
</style>
</head>
<body>

<div class="top-toolbar">
  <button onclick="applyCurrency('$')">$</button>
  <button onclick="applyCurrency('‚Ç¨')">‚Ç¨</button>
  <button onclick="applyCurrency('UZS')">UZS</button>
  <button onclick="applyCurrency('‚Ç∏')">‚Ç∏</button>
  <button onclick="applyCurrency('‚Çº')">‚Çº</button>
  <button onclick="applyCurrency('INR')">INR</button>
  <button onclick="applyCurrency('BDT')">BDT</button>
  <button onclick="applyCurrency('CLP')">CLP</button>
  <button onclick="applyCurrency('MXN')">MXN</button>
  <button onclick="applyCurrency('GTQ')">GTQ</button>
  <button onclick="applyCurrency('HNL')">HNL</button>
  <button onclick="applyCurrency('BOB')">BOB</button>
  <button onclick="applyCurrency('NGN')">NGN</button>
  <button onclick="applyCurrency('KES')">KES</button>
</div>

<div class="mode">
  <label><input type="checkbox" id="doubleMode"> Double bonus</label>
</div>

<div class="flex-horiz">
  <div id="areas" class="textAreas">
    <div class="text-wrap active" data-key="a">
      <textarea id="textAreaA" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ..."></textarea>
    </div>
    <!-- –í—Ç–æ—Ä–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–∏ Double -->
    <div class="text-wrap" data-key="b" style="display:none;">
      <textarea id="textAreaB" placeholder="–í—Ç–æ—Ä–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–¥–ª—è double)..."></textarea>
    </div>
  </div>

  <div id="tableContainer">
    <table id="outputTable"></table>
  </div>
</div>

<div class="btm-toolbar">
  <button onclick="addText('Bonus Sport')">Bonus Sport</button>
  <button onclick="addText('Bonus Casino')">Bonus Casino</button>
  <button onclick="addText('Free Bet')">Free Bet</button>
  <button onclick="addText('Free Spins')">Free Spins</button>
  <button onclick="addText('Real Money')">Real Money</button>
  <button onclick="wrapInBrackets()">[...]</button>
  <button class="ready" onclick="generateTable()">Ready</button>
  <button onclick="clearExtra()">üßπ Clear</button>
  <button onclick="undo()">‚Ü©Ô∏è</button>
  <button onclick="redo()">‚Ü™Ô∏è</button>
</div>

<div class="custom-text-container">
  <input type="text" id="customTextInput" class="custom-text" placeholder="custom text..." />
  <button onclick="addCustomText()">‚òëÔ∏è</button>
</div>

<script>
  // Elements
  const areaA = document.getElementById('textAreaA');
  const areaB = document.getElementById('textAreaB');
  const wraps = Array.from(document.querySelectorAll('.text-wrap'));
  const areasBox = document.getElementById('areas');
  const doubleMode = document.getElementById('doubleMode');
  const customTextInput = document.getElementById('customTextInput');
  const tableContainer = document.getElementById('tableContainer');
  const outputTable = document.getElementById('outputTable');

  // History stacks store BOTH columns
  const undoStack = [];
  const redoStack = [];

  // Active area management
  let activeKey = 'a'; // 'a' or 'b'
  function getActiveArea(){ return activeKey === 'a' ? areaA : areaB; }
  function setActive(key){
    activeKey = key;
    wraps.forEach(w => w.classList.toggle('active', w.dataset.key === key));
  }
  wraps.forEach(w => {
    const key = w.dataset.key;
    const ta = key === 'a' ? areaA : areaB;
    ta.addEventListener('focus', () => setActive(key));
    // –∫–ª–∏–∫ –ø–æ –æ–±–ª–∞—Å—Ç–∏ —Ç–æ–∂–µ —Å—Ç–∞–≤–∏—Ç –∞–∫—Ç–∏–≤
    w.addEventListener('click', () => { (key==='a'?areaA:areaB).focus(); setActive(key);});
  });

  function saveState(){
    undoStack.push({ a: areaA.value, b: areaB.value, active: activeKey, double: doubleMode.checked });
    if (undoStack.length > 200) undoStack.shift();
    redoStack.length = 0;
  }
  function restoreState(s){
    areaA.value = s.a; areaB.value = s.b; setActive(s.active); doubleMode.checked = s.double; toggleDoubleUI();
  }

  function undo(){
    if (undoStack.length){
      const cur = { a: areaA.value, b: areaB.value, active: activeKey, double: doubleMode.checked };
      const prev = undoStack.pop();
      redoStack.push(cur);
      restoreState(prev);
    }
  }
  function redo(){
    if (redoStack.length){
      const cur = { a: areaA.value, b: areaB.value, active: activeKey, double: doubleMode.checked };
      const next = redoStack.pop();
      undoStack.push(cur);
      restoreState(next);
    }
  }

  // Double UI toggle
  function toggleDoubleUI(){
    const second = wraps.find(w => w.dataset.key === 'b');
    if (doubleMode.checked){
      areasBox.classList.add('double');
      second.style.display = '';
    } else {
      areasBox.classList.remove('double');
      second.style.display = 'none';
      // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–º –±—ã–ª b ‚Äî –≤–µ—Ä–Ω—ë–º—Å—è –∫ a
      if (activeKey === 'b') setActive('a');
    }
  }
  doubleMode.addEventListener('change', () => { saveState(); toggleDoubleUI(); });

  // Helpers
  function mapLines(text, mapper){
    return text.split('\n').map(line => mapper(line)).join('\n');
  }
  function cleanToNumberString(s){ return s.replace(/[^0-9]/g,''); }

  // Formatting functions apply to ACTIVE area only
  function applyCurrency(currency){
    saveState();
    const ta = getActiveArea();
    const lines = ta.value.split('\n');
    const updated = lines.map(line => {
      const trimmed = line.trim();
      if (!trimmed) return '';
      return formatCurrency(trimmed, currency);
    });
    ta.value = updated.join('\n');
  }

  function formatCurrency(value, currency){
    const number = parseFloat(value.replace(/[^0-9]/g, ''));
    if (isNaN(number)) return value;
    switch (currency) {
      case '‚Ç¨':  return `‚Ç¨ ${number.toLocaleString('en-US').replace(/,/g, ' ')}`;
      case 'UZS':return `${number.toLocaleString('en-US').replace(/,/g, ' ')} SO‚ÄôM`;
      case '‚Ç∏':  return `${number.toLocaleString('en-US').replace(/,/g, ' ')} ‚Ç∏`;
      case '‚Çº':  return `${number.toLocaleString('en-US').replace(/,/g, ' ')} ‚Çº`;
      case 'INR':return `${number.toLocaleString('en-IN')} INR`;
      case 'BDT':return `${number.toLocaleString('en-IN')} BDT`;
      case 'CLP':return `$ ${number.toLocaleString('en-US').replace(/,/g, ' ')}`;
      case 'MXN':return `$ ${number.toLocaleString('en-US').replace(/,/g, ' ')}`;
      case 'GTQ':return `Q${number.toLocaleString('en-US')}`;
      case 'HNL':return `L ${number.toLocaleString('en-US')}`;
      case 'BOB':return `Bs ${number.toLocaleString('en-US').replace(/,/g, '.')}`;
      case 'NGN':return `‚Ç¶${number.toLocaleString('en-US')}`;
      case 'KES':return `KSH ${number.toLocaleString('en-US')}`;
      default:   return `$ ${number.toLocaleString('en-US').replace(/,/g, ' ')}`;
    }
  }

  function addText(text){
    saveState();
    const ta = getActiveArea();
    const lines = ta.value.split('\n');
    const updated = lines.map(line => {
      const trimmed = line.trim();
      if (!trimmed) return '';
      return `${trimmed} ${text}`.trim();
    });
    ta.value = updated.join('\n');
  }

  function addCustomText(){
    const customText = customTextInput.value.trim();
    if (!customText) return;
    addText(customText);
    customTextInput.value = '';
  }

  function wrapInBrackets(){
    saveState();
    const ta = getActiveArea();
    const lines = ta.value.split('\n');
    const updated = lines.map(line => {
      const trimmed = line.trim();
      if (!trimmed) return '';
      return `[${trimmed}]`;
    });
    ta.value = updated.join('\n');
  }

  function clearExtra(){
    saveState();
    const ta = getActiveArea();
    const lines = ta.value.split('\n');
    const cleaned = lines.map(line => {
      const number = cleanToNumberString(line).trim();
      return number || '';
    });
    ta.value = cleaned.join('\n');
  }

  function generateTable(){
    outputTable.innerHTML = '';
    const aLines = areaA.value.split('\n').map(s=>s.trim()).filter(Boolean);
    const isDouble = doubleMode.checked;

    if (isDouble){
      const bLines = areaB.value.split('\n').map(s=>s.trim());
      const maxLen = Math.max(aLines.length, bLines.filter(Boolean).length);
      for (let i=0;i<maxLen;i++){
        const left  = aLines[i] || '';
        const right = (bLines[i] || '').trim();
        const parts = [left, right].filter(Boolean);
        if (!parts.length) continue;
        const combined = parts.length === 2 ? `[${parts[0]} + ${parts[1]}]` : `[${parts[0]}]`;
        appendRow(combined);
      }
    } else {
      // –∫–∞–∫ –±—ã–ª–æ: –±–µ—Ä—ë–º –Ω–µ–ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –Ω–µ –≤–º–µ—à–∏–≤–∞–µ–º—Å—è
      aLines.forEach(line => appendRow(line));
    }

    tableContainer.style.display = 'block';
    selectTableContent();
  }

  function appendRow(text){
    const row = document.createElement('tr');
    const cell = document.createElement('td');
    cell.textContent = text;
    row.appendChild(cell);
    outputTable.appendChild(row);
  }

  function selectTableContent(){
    const range = document.createRange();
    range.selectNodeContents(outputTable);
    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
  }
</script>
</body>
</html>
